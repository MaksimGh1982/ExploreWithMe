
CREATE TABLE IF NOT EXISTS USERS
( id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  Name  VARCHAR(255) NOT NULL,
  created TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
  PRIMARY KEY (Id));

CREATE TABLE IF NOT EXISTS Categories
( id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  Name VARCHAR(255) NOT NULL UNIQUE,
  PRIMARY KEY (Id));


CREATE TABLE IF NOT EXISTS Compilations
( id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  title VARCHAR(255) NOT NULL UNIQUE,
  pinned boolean NOT NULL,
  PRIMARY KEY (Id));

CREATE TABLE IF NOT EXISTS Events
( id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  annotation VARCHAR(2000) NOT NULL,
  category_Id	INTEGER NOT NULL,
  description VARCHAR(7000) NOT NULL,
  event_date  TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  created_on  TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
  published_on  TIMESTAMP WITHOUT TIME ZONE,
  location_lat	 NUMERIC NOT NULL,
  location_lon	 NUMERIC NOT NULL,
  paid	BOOLEAN DEFAULT false,
  participant_limit	INTEGER DEFAULT 0,
  request_Moderation	BOOLEAN DEFAULT true,
  title VARCHAR(120) NOT NULL,
  views INTEGER DEFAULT 0,
  confirmed_requests INTEGER DEFAULT 0,
  initiator_Id INTEGER NOT NULL,
  state  VARCHAR(255) NOT NULL,
  PRIMARY KEY (Id),
  FOREIGN KEY (category_Id)  REFERENCES Categories(Id) ON DELETE RESTRICT);

CREATE TABLE IF NOT EXISTS compilation_events
( id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  Compilation_Id INTEGER NOT NULL,
  Event_Id INTEGER NOT NULL,
  PRIMARY KEY (Id),
  FOREIGN KEY (Compilation_Id)  REFERENCES Compilations (Id),
  FOREIGN KEY (Event_Id)  REFERENCES Events (Id));


CREATE TABLE IF NOT EXISTS Requests
(  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  Requester_Id INTEGER NOT NULL,
  Event_Id INTEGER NOT NULL,
  created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  status  VARCHAR(255) NOT NULL,
  PRIMARY KEY (Id),
  FOREIGN KEY (Event_Id)  REFERENCES Events (Id));

  CREATE TABLE IF NOT EXISTS Views
  (  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    Event_Id INTEGER NOT NULL,
    created TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    ip VARCHAR(255) NOT NULL,
    PRIMARY KEY (Id),
    FOREIGN KEY (Event_Id)  REFERENCES Events (Id));


    CREATE TABLE IF NOT EXISTS Comments
      (  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
        content VARCHAR(1000) NOT NULL,
        created TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
        Event_Id INTEGER NOT NULL,
        User_id INTEGER NOT NULL,
        status  VARCHAR(255) NOT NULL,
        PRIMARY KEY (Id),
        FOREIGN KEY (Event_Id)  REFERENCES Events (Id),
        FOREIGN KEY (User_Id)  REFERENCES Users (Id));
